-- Proton Exploit v5
-- Keyless, Rayfield UI, FULLY FIXED + SERVER HOPPER + AUTO REJOIN
-- by fluxu

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Proton",
   LoadingTitle = "Proton v5 Loading...",
   LoadingSubtitle = "by fluxu",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "ProtonConfig",
      FileName = "ProtonV5"
   },
   Discord = {
      Enabled = false
   },
   KeySystem = false
})

-- === SERVICES ===
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local CoreGui = game:GetService("CoreGui")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- === STATE VARIABLES ===
local AntiKickEnabled = true
local AntiKillEnabled = true
local AntiDisconnectEnabled = true
local DisableStrictACEnabled = true
local AntiGameTPEnabled = true
local AntiFlingEnabled = true
local DodgeEnabled = false
local DodgeMedusaEnabled = false
local AutoRejoinEnabled = true
local ServerHopperEnabled = false

-- === TABS ===
local SettingsTab = Window:CreateTab("Settings", 4483362458)
local BrainrotTab = Window:CreateTab("Steal A Brainrot", 6035056541)
local ServerTab = Window:CreateTab("Server", 4483362458)

-- === SETTINGS TOGGLES ===
SettingsTab:CreateToggle({
   Name = "Anti Kick",
   CurrentValue = true,
   Flag = "AntiKick",
   Callback = function(v) AntiKickEnabled = v end,
})

SettingsTab:CreateToggle({
   Name = "Anti Kill (Godmode)",
   CurrentValue = true,
   Flag = "AntiKill",
   Callback = function(v) AntiKillEnabled = v end,
})

SettingsTab:CreateToggle({
   Name = "Anti Disconnect",
   CurrentValue = true,
   Flag = "AntiDisconnect",
   Callback = function(v) AntiDisconnectEnabled = v end,
})

SettingsTab:CreateToggle({
   Name = "Disable Strict AntiCheat",
   CurrentValue = true,
   Flag = "DisableStrictAC",
   Callback = function(v)
      DisableStrictACEnabled = v
      if v then RunStrictACDisabler() end
   end,
})

SettingsTab:CreateToggle({
   Name = "Anti Game Teleport",
   Info = "Blocks forced teleports & server hops",
   CurrentValue = true,
   Flag = "AntiGameTP",
   Callback = function(v) AntiGameTPEnabled = v end,
})

-- === BRAINROT TAB TOGGLES ===
BrainrotTab:CreateToggle({
   Name = "Anti Fling",
   Info = "Noclip with players only (not objects)",
   CurrentValue = true,
   Flag = "AntiFling",
   Callback = function(v) AntiFlingEnabled = v end,
})

BrainrotTab:CreateToggle({
   Name = "Dodge",
   Info = "Auto-dodge players within 10 studs",
   CurrentValue = false,
   Flag = "Dodge",
   Callback = function(v) DodgeEnabled = v end,
})

BrainrotTab:CreateToggle({
   Name = "Dodge Medusa",
   Info = "Instantly move 55 studs away from any player",
   CurrentValue = false,
   Flag = "DodgeMedusa",
   Callback = function(v) DodgeMedusaEnabled = v end,
})

-- === SERVER TAB ===
ServerTab:CreateToggle({
   Name = "Auto Rejoin",
   Info = "Rejoin same server if kicked",
   CurrentValue = true,
   Flag = "AutoRejoin",
   Callback = function(v) AutoRejoinEnabled = v end,
})

ServerTab:CreateButton({
   Name = "Server Hop",
   Info = "Teleport to a new server",
   Callback = function()
      if ServerHopperEnabled then return end
      ServerHopperEnabled = true
      Rayfield:Notify({Title="Server Hop", Content="Finding new server...", Duration=3})
      HopServer()
   end,
})

-- === ULTRA ANTI-KICK ===
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
local oldIndex = mt.__index
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
   local method = getnamecallmethod()
   if AntiKickEnabled then
      if method == "Kick" and self == LocalPlayer then return end
      if method == "kick" or method == "Disconnect" then return end
      if method == "TeleportToPlaceInstance" and AntiGameTPEnabled then return end
   end
   return oldNamecall(self, ...)
end)

mt.__index = newcclosure(function(self, key)
   if AntiKickEnabled and self == LocalPlayer and (key == "Kick" or key == "kick") then
      return function() end
   end
   return oldIndex(self, key)
end)

setreadonly(mt, true)

-- === ANTI-GAME-TP ===
local oldTP = TeleportService.Teleport
TeleportService.Teleport = newcclosure(function(...)
   if AntiGameTPEnabled then return end
   return oldTP(...)
end)

-- === GODMODE (FIXED) ===
local function ApplyGodMode(char)
   if not char or not AntiKillEnabled then return end
   task.spawn(function()
      local hum = char:FindFirstChildOfClass("Humanoid")
      if not hum then return end
      hum.Health = math.huge
      hum.MaxHealth = math.huge
      hum.BreakJoints = function() end
      for _, state in pairs(Enum.HumanoidStateType:GetEnumItems()) do
         pcall(function() hum:SetStateEnabled(state, false) end)
      end
   end)
end

LocalPlayer.CharacterAdded:Connect(ApplyGodMode)
if LocalPlayer.Character then ApplyGodMode(LocalPlayer.Character) end

-- === ANTI-DISCONNECT + AUTO REJOIN ===
LocalPlayer.OnTeleport:Connect(function(state)
   if AutoRejoinEnabled and state == Enum.TeleportState.Started then
      TeleportService:Teleport(game.PlaceId, LocalPlayer)
   end
end)

CoreGui.RobloxGui:BindToClose(function()
   if AntiDisconnectEnabled then
      while task.wait() do end
   end
end)

-- === BRAINROT STEALER + AC KILLER (FIXED) ===
local blocked = {
   "anticheat","ac","anti","exploit","cheat","security","protector",
   "adonis","krystal","eclipse","fates","hdadmin","admin","kohls",
   "detect","check","validator","integrity","synapse","fluxus",
   "brainrot","brainrots","rot","bypass","fe"
}

local function isBrainrot(obj)
   if not obj or not obj.Name then return false end
   local n = obj.Name:lower()
   for _, k in blocked do
      if n:find(k) then return true end
   end
   return false
end

local function RunStrictACDisabler()
   if not DisableStrictACEnabled then return end
   for _, obj in game:GetDescendants() do
      if (obj:IsA("Script") or obj:IsA("LocalScript") or obj:IsA("ModuleScript")) and isBrainrot(obj) then
         pcall(obj.Destroy, obj)
      end
   end
   game.DescendantAdded:Connect(function(obj)
      if DisableStrictACEnabled and (obj:IsA("Script") or obj:IsA("LocalScript")) and isBrainrot(obj) then
         task.defer(function() pcall(obj.Destroy, obj) end)
      end
  end)
   local oldReq = require
   require = newcclosure(function(mod)
      if DisableStrictACEnabled and isBrainrot(mod) then
         return setmetatable({}, {__index = function() return function() end end})
      end
      return oldReq(mod)
   end)
end

if DisableStrictACEnabled then RunStrictACDisabler() end

-- === ANTI FLING (Noclip Players Only - FIXED) ===
local function UpdateNoclip()
   if not AntiFlingEnabled or not LocalPlayer.Character then return end
   for _, part in LocalPlayer.Character:GetDescendants() do
      if part:IsA("BasePart") then
         part.CanCollide = false
      end
   end
   -- Allow collision with non-player parts
   for _, obj in Workspace:GetDescendants() do
      if obj:IsA("BasePart") and obj.Parent and not obj.Parent:FindFirstChild("Humanoid") then
         obj.CanCollide = true
      end
   end
end

RunService.Stepped:Connect(UpdateNoclip)

-- === DODGE (FIXED) ===
RunService.Heartbeat:Connect(function()
   if not DodgeEnabled or not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
   local root = LocalPlayer.Character.HumanoidRootPart
   for _, plr in Players:GetPlayers() do
      if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
         local dist = (root.Position - plr.Character.HumanoidRootPart.Position).Magnitude
         if dist < 10 then
            local dir = (root.Position - plr.Character.HumanoidRootPart.Position).Unit
            root.CFrame = root.CFrame + dir * 15
         end
      end
   end
end)

-- === DODGE MEDUSA (FIXED) ===
RunService.Heartbeat:Connect(function()
   if not DodgeMedusaEnabled or not LocalPlayer.Character or not LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then return end
   local root = LocalPlayer.Character.HumanoidRootPart
   for _, plr in Players:GetPlayers() do
      if plr ~= LocalPlayer and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
         local dist = (root.Position - plr.Character.HumanoidRootPart.Position).Magnitude
         if dist < 60 then
            local dir = (root.Position - plr.Character.HumanoidRootPart.Position).Unit
            root.CFrame = CFrame.new(root.Position + dir * 55)
         end
      end
   end
end)

-- === SERVER HOP FUNCTION ===
function HopServer()
   local servers = {}
   local req = HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..game.PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
   for _, v in pairs(req.data) do
      if v.playing < v.maxPlayers and v.id ~= game.JobId then
         table.insert(servers, v.id)
      end
   end
   if #servers > 0 then
      TeleportService:TeleportToPlaceInstance(game.PlaceId, servers[math.random(1, #servers)], LocalPlayer)
   else
      Rayfield:Notify({Title="Server Hop", Content="No servers found!", Duration=3})
   end
end

-- === NOTIFICATION ===
Rayfield:Notify({
   Title = "Proton v5 Active",
   Content = "by fluxu | All features fixed. Auto Rejoin ON.",
   Duration = 7,
   Image = 6035056541
})

Rayfield:LoadConfiguration()
