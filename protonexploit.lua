-- Proton Exploit v2
-- Keyless, Rayfield UI, Enhanced Anti-Features
-- by fluxu

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Proton",
   LoadingTitle = "Proton Loading...",
   LoadingSubtitle = "by fluxu",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "ProtonConfig",
      FileName = "ProtonSettings"
   },
   Discord = {
      Enabled = false
   },
   KeySystem = false
})

-- Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local CoreGui = game:GetService("CoreGui")
local LocalPlayer = Players.LocalPlayer

-- State Variables
local AntiKickEnabled = true
local AntiKillEnabled = true
local AntiDisconnectEnabled = true
local DisableStrictACEnabled = true

-- === TABS ===
local SettingsTab = Window:CreateTab("Settings", 4483362458) -- Icon: Gear

-- === TOGGLES ===
SettingsTab:CreateToggle({
   Name = "Anti Kick",
   CurrentValue = true,
   Flag = "AntiKick",
   Callback = function(Value)
      AntiKickEnabled = Value
   end,
})

SettingsTab:CreateToggle({
   Name = "Anti Kill",
   CurrentValue = true,
   Flag = "AntiKill",
   Callback = function(Value)
      AntiKillEnabled = Value
   end,
})

SettingsTab:CreateToggle({
   Name = "Anti Disconnect",
   CurrentValue = true,
   Flag = "AntiDisconnect",
   Callback = function(Value)
      AntiDisconnectEnabled = Value
   end,
})

SettingsTab:CreateToggle({
   Name = "Disable Strict AntiCheat",
   CurrentValue = true,
   Flag = "DisableStrictAC",
   Callback = function(Value)
      DisableStrictACEnabled = Value
      if Value then
         RunStrictACDisabler()
      end
   end,
})

-- === ENHANCED ANTI-KICK (Namecall + Kick Method Hooking) ===
local mt = getrawmetatable(game)
local oldNamecall = mt.__namecall
local oldIndex = mt.__index
local oldNewIndex = mt.__newindex
setreadonly(mt, false)

mt.__namecall = newcclosure(function(self, ...)
   local method = getnamecallmethod()
   local args = {...}

   if AntiKickEnabled then
      if method == "Kick" and self == LocalPlayer then
         return -- Block kick
      end
      if method == "kick" or method == "Disconnect" then
         return
      end
   end

   return oldNamecall(self, ...)
end)

-- Block Player:Kick() via index
mt.__index = newcclosure(function(self, key)
   if AntiKickEnabled and self == LocalPlayer and (key == "Kick" or key == "kick") then
      return function() end
   end
   return oldIndex(self, key)
end)

setreadonly(mt, true)

-- === ANTI-KILL: GOD MODE + HEALTH LOCK + BREAKJOINT BLOCK ===
local function ApplyGodMode(char)
   if not char or not AntiKillEnabled then return end

   local humanoid = char:FindFirstChildOfClass("Humanoid")
   if not humanoid then return end

   -- Prevent death
   humanoid.HealthChanged:Connect(function(health)
      if health <= 0 and AntiKillEnabled then
         humanoid.Health = humanoid.MaxHealth
      end
   end)

   -- Block BreakJoints
   humanoid.BreakJoints = function() end

   -- Max health
   humanoid.MaxHealth = math.huge
   humanoid.Health = math.huge

   -- Disable state changes
   humanoid:SetStateEnabled(Enum.HumanoidStateType.Dead, false)
   humanoid:SetStateEnabled(Enum.HumanoidStateType.Ragdoll, false)
   humanoid:SetStateEnabled(Enum.HumanoidStateType.FallingDown, false)
end

-- Apply on spawn & respawn
LocalPlayer.CharacterAdded:Connect(ApplyGodMode)
if LocalPlayer.Character then
   ApplyGodMode(LocalPlayer.Character)
end

-- === ANTI-DISCONNECT: Block GUI Close + Rejoin Protection ===
CoreGui.RobloxGui:BindToClose(function()
   if AntiDisconnectEnabled then
      task.wait(9e9) -- Infinite stall
   end
end)

-- Prevent game:BindToClose
local oldClose = game.Close
game.Close = newcclosure(function(...)
   if AntiDisconnectEnabled then
      return
   end
   return oldClose(...)
end)

-- === DISABLE STRICT ANTICHEAT: AGGRESSIVE SCRIPT & MODULE NEUTRALIZATION ===
local function RunStrictACDisabler()
   if not DisableStrictACEnabled then return end

   local blockedNames = {
      "anticheat", "ac", "anti", "exploit", "cheat", "security", "protector",
      "adonis", "krystal", "eclipse", "fates", "hdadmin", "admin", "kohls",
      "detect", "check", "validator", "integrity", "synapse", "fluxus"
   }

   local function isSuspicious(obj)
      if not obj.Name then return false end
      local name = obj.Name:lower()
      for _, keyword in ipairs(blockedNames) do
         if name:find(keyword) then
            return true
         end
      end
      return false
   end

   -- Destroy existing AC scripts
   for _, obj in ipairs(Workspace:GetDescendants()) do
      if (obj:IsA("LocalScript") or obj:IsA("Script") or obj:IsA("ModuleScript")) and isSuspicious(obj) then
         obj:Destroy()
      end
   end

   for _, obj in ipairs(game:GetService("ReplicatedStorage"):GetDescendants()) do
      if obj:IsA("ModuleScript") and isSuspicious(obj) then
         obj:Destroy()
      end
   end

   -- Monitor new additions
   Workspace.DescendantAdded:Connect(function(obj)
      if DisableStrictACEnabled and (obj:IsA("LocalScript") or obj:IsA("Script")) and isSuspicious(obj) then
         task.defer(function() pcall(function() obj:Destroy() end) end)
      end
   end)

   game:GetService("ReplicatedStorage").DescendantAdded:Connect(function(obj)
      if DisableStrictACEnabled and obj:IsA("ModuleScript") and isSuspicious(obj) then
         task.defer(function() pcall(function() obj:Destroy() end) end)
      end
   end)

   -- Disable RemoteEvent/RemoteFunction spam checks (common in AC)
   for _, remote in ipairs(game:GetDescendants()) do
      if remote:IsA("RemoteEvent") or remote:IsA("RemoteFunction") then
         if isSuspicious(remote) or remote.Name:lower():find("check") or remote.Name:lower():find("report") then
            remote:Destroy()
         end
      end
   end

   -- Hook require() to block AC modules
   local oldRequire = require
   require = newcclosure(function(module)
      if DisableStrictACEnabled and isSuspicious(module) then
         return function() end
      end
      return oldRequire(module)
   end)
end

-- Run on load if enabled
if DisableStrictACEnabled then
   RunStrictACDisabler()
end

-- === NOTIFICATION ON LOAD ===
Rayfield:Notify({
   Title = "Proton Loaded",
   Content = "by fluxu â€” All anti-features enabled.",
   Duration = 6,
   Image = 4483362458
})

-- Load saved config
Rayfield:LoadConfiguration()
